<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <title>SAHRABA Multiplayer Tavla</title>

  <style>
    body { margin: 0; display: flex; height: 100vh; font-family: sans-serif; }
    #chatPanel {
      width: 280px;
      background: #f4f4f4;
      border-right: 2px solid #ccc;
      padding: 10px;
      box-sizing: border-box;
      display: flex;
      flex-direction: column;
    }
    #playerInfo { white-space: pre-line; font-weight: bold; margin-bottom: 10px; }
    #chatMessages {
      flex: 1;
      overflow-y: auto;
      margin-bottom: 10px;
      border: 1px solid #ddd;
      padding: 5px;
      background: #fff;
    }
    #chatInput { width: 100%; box-sizing: border-box; margin-bottom: 5px; }
    #gameFrame {
      flex: 1;
      border: none;
      width: 100%;
      height: 100%;
    }
    button { padding: 6px; background: #333; color: #fff; border: none; cursor: pointer; }
    button:hover { background: #555; }
    .exitBtn { margin-top:10px; background:#c00; }
  </style>

  <!-- WebSocket bağlantısı -->
  <script>
    const ws = new WebSocket("wss://sahraba-multiplayer.onrender.com");

    ws.onopen = () => {
      console.log("✅ WebSocket bağlandı");
      ws.send(JSON.stringify({ type: "join", room: room }));
    };

    ws.onmessage = (event) => {
      const data = JSON.parse(event.data);

      // Sohbet mesajı
      if (data.type === "chat") {
        addChatMessage(data.user, data.message);
      }

      // Oyuncu listesi
      if (data.type === "players") {
        updatePlayerList(data.players);
      }
    };

    ws.onerror = (err) => console.error("⚠️ WebSocket hatası:", err);
    ws.onclose = () => console.log("❌ WebSocket kapandı");
  </script>

</head>

<body>

  <!-- Sol sohbet paneli -->
  <div id="chatPanel">
    <h3>Sohbet</h3>
    <div id="playerInfo"></div>
    <div id="chatMessages"></div>
    <input type="text" id="chatInput" placeholder="Mesaj yaz...">
    <button onclick="sendChat()">Gönder</button>
    <button class="exitBtn" onclick="exitGame()">Oyunu Kapat</button>
  </div>

  <!-- Oyun sahnesi -->
  <iframe id="gameFrame"></iframe>

  <script>
    // URL parametreleri
    const urlParams = new URLSearchParams(window.location.search);
    const username = urlParams.get("username") || "Unknown";
    const city = urlParams.get("city") || "Unknown";
    const room = urlParams.get("room") || "default";

    // Oyuncu listesi güncelle
    function updatePlayerList(players) {
      let list = `Oda: ${room}\nOyuncular:\n`;
      players.forEach(p => {
        list += `- ${p.user} (${p.city})\n`;
      });
      document.getElementById("playerInfo").innerText = list;
    }

    // Sohbet mesajı ekle
    function addChatMessage(user, message) {
      const chatBox = document.getElementById("chatMessages");
      const newMsg = document.createElement("div");
      newMsg.innerHTML = `<strong>${user}:</strong> ${message}`;
      chatBox.appendChild(newMsg);
      chatBox.scrollTop = chatBox.scrollHeight;
    }

    // Sohbet gönder
    function sendChat() {
      const input = document.getElementById("chatInput");
      const msg = input.value.trim();
      if (!msg) return;

      ws.send(JSON.stringify({
        type: "chat",
        room: room,
        user: `${username} (${city})`,
        message: msg
      }));

      input.value = "";
    }

    // Oyunu kapat
    function exitGame() {
      document.getElementById("gameFrame").src = "https://sahraba.com/games/";
    }

    // Oyun iframe’ini aç
    document.getElementById("gameFrame").src =
